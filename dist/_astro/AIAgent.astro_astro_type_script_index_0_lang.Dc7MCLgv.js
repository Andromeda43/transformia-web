document.addEventListener("DOMContentLoaded",()=>{const N=document.getElementById("intelligentAgent"),k=document.getElementById("agentDirection"),M=document.getElementById("neuralConnections"),C=document.getElementById("plannedPathContainer"),D=document.querySelectorAll(".interaction-node"),I=document.querySelectorAll(".particle"),L=document.getElementById("processingMetric"),q=document.getElementById("confidenceMetric"),z=document.getElementById("tasksMetric"),T=document.getElementById("consoleText1"),B=document.getElementById("consoleText2"),w=document.getElementById("consoleText3");let A=50,E=50,$=Math.random()*80+10,P=Math.random()*80+10,m=[];const W=3;let y=0,x=0,v=!0;const H=[];function R(){I.length&&I.forEach((o,t)=>{const e=o,n=t/I.length*Math.PI*2,i=30+Math.sin(Date.now()*.003+t)*10;let s=0;if(m.length>1&&y<m.length-1){const d=m[y],r=m[y+1],l=r.x-d.x,h=r.y-d.y;s=Math.sqrt(l*l+h*h)*20}const c=Math.cos(n+Date.now()*.001)*i+s*Math.sin(n),a=Math.sin(n+Date.now()*.001)*i-s*Math.cos(n);e.style.left=`calc(50% + ${c}px)`,e.style.top=`calc(50% + ${a}px)`,e.style.opacity=`${.2+Math.sin(Date.now()*.002+t)*.3+.5}`})}function Y(){if(!M)return;const o="http://www.w3.org/2000/svg",t=document.createElementNS(o,"svg");t.setAttribute("width","100%"),t.setAttribute("height","100%"),M.appendChild(t),D.forEach(n=>{const i=n.getBoundingClientRect(),s=M?.getBoundingClientRect()??{left:0,top:0,width:window.innerWidth,height:window.innerHeight},c=(i.left+i.width/2-s.left)/s.width*100,a=(i.top+i.height/2-s.top)/s.height*100;H.push({x:c,y:a})});function e(){for(;t.firstChild;)t.removeChild(t.firstChild);if(!M)return;const n=M.offsetWidth,i=M.offsetHeight,s=A*n/100,c=E*i/100;H.forEach((a,d)=>{const r=a.x*n/100,l=a.y*i/100,h=r-s,u=l-c,b=Math.sqrt(h*h+u*u);if(b<300){const p=1-b/300,f=document.createElementNS(o,"line");if(f.setAttribute("x1",s.toString()),f.setAttribute("y1",c.toString()),f.setAttribute("x2",r.toString()),f.setAttribute("y2",l.toString()),f.setAttribute("stroke",`rgba(176, 66, 255, ${p*.7})`),f.setAttribute("stroke-width","1"),t.appendChild(f),Math.random()>.7){const g=document.createElementNS(o,"circle");g.setAttribute("r","3"),g.setAttribute("fill","#ffffff");const S=document.createElementNS(o,"animateMotion");S.setAttribute("path",`M${s},${c} L${r},${l}`),S.setAttribute("dur",`${Math.random()*1.5+.5}s`),S.setAttribute("repeatCount","1"),g.appendChild(S),t.appendChild(g)}}})}setInterval(e,300)}function X(o,t,e,n){const i=[];i.push({x:o,y:t});for(let s=0;s<W-2;s++){const c=(s+1)/(W-1),a=o+(e-o)*c,d=t+(n-t)*c,r=n-t,l=-(e-o),h=Math.sqrt(r*r+l*l),u=(Math.random()*2-1)*Math.min(h*.3,20);i.push({x:a+r/h*u,y:d+l/h*u})}return i.push({x:e,y:n}),i}function j(){if(!C)return;const o="http://www.w3.org/2000/svg",t=document.createElementNS(o,"svg");t.setAttribute("width","100%"),t.setAttribute("height","100%"),C.appendChild(t);const e=document.createElementNS(o,"path");e.setAttribute("fill","none"),e.setAttribute("stroke","rgba(176, 66, 255, 0.4)"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-dasharray","5,3");const n=[],i=20;function s(){if(!C)return;const c=C.offsetWidth,a=C.offsetHeight,d=A*c/100,r=E*a/100,l=$*c/100,h=P*a/100;if(n.push({x:d,y:r}),n.length>i&&n.shift(),n.length>1){const u=document.createElementNS(o,"path");let b=`M ${n[0].x} ${n[0].y}`;for(let p=1;p<n.length;p++)b+=` L ${n[p].x} ${n[p].y}`;for(u.setAttribute("d",b),u.setAttribute("fill","none"),u.setAttribute("stroke","rgba(100, 200, 255, 0.4)"),u.setAttribute("stroke-width","2");t.firstChild;)t.removeChild(t.firstChild);if(t.appendChild(u),l!==d||h!==r){if(m.length>1){let p=`M ${d} ${r}`;const f=m.map(g=>({x:g.x*c/100,y:g.y*a/100}));for(let g=1;g<f.length;g++)p+=` L ${f[g].x} ${f[g].y}`;e.setAttribute("d",p)}else e.setAttribute("d",`M ${d} ${r} L ${l} ${h}`);t.appendChild(e)}}}setInterval(s,100)}function F(){if(!N||!k)return;function o(){if(v&&(m=X(A,E,$,P),x=0,y=0,v=!1),x+=.01,x>=1&&(y>=m.length-2?($=Math.random()*80+10,P=Math.random()*80+10,v=!0):(y++,x=0)),m.length>1){const e=m[y],n=m[y+1];A=e.x+(n.x-e.x)*x,E=e.y+(n.y-e.y)*x;const i=n.x-e.x,s=n.y-e.y,c=Math.atan2(s,i)*180/Math.PI,a=k;a.style.transform=`translateY(-50%) rotate(${c}deg)`;const d=Math.sqrt(i*i+s*s);a.style.opacity=Math.min(1,d*10).toString()}const t=N;t.style.left=`${A}%`,t.style.top=`${E}%`,R(),requestAnimationFrame(o)}o()}function O(){if(!L||!q||!z)return;let o=85,t=92,e=3;setInterval(()=>{o+=(Math.random()-.5)*10,o=Math.max(60,Math.min(98,o)),t+=(Math.random()-.5)*8,t=Math.max(70,Math.min(99,t)),Math.random()<.1&&(e=Math.floor(Math.random()*5)+1);const n=L,i=q;n.style.width=`${o}%`,i.style.width=`${t}%`,z&&(z.textContent=e.toString())},3e3)}function Z(){const o=["Analizando datos","Procesando respuesta","Optimizando resultado","Evaluando opciones","Aplicando aprendizaje","Generando predicciones","Conectando sistemas","Mejorando precisión","Priorizando acciones","Actualizando modelos"];setInterval(()=>{if(T&&B&&w){T.textContent=B.textContent,B.textContent=w.textContent;const t=Math.floor(Math.random()*o.length);w.textContent=o[t]}},4e3)}function G(){const o=document.querySelector(".decision-zones");if(o)for(let t=0;t<10;t++){const e=document.createElement("div");e.className="decision-zone";const n=Math.random()*80+10,i=Math.random()*80+10,s=Math.random()*100+50,c=Math.random()*.7+.1;e.style.left=`${n}%`,e.style.top=`${i}%`,e.style.width=`${s}px`,e.style.height=`${s}px`,e.style.opacity=c.toString(),o.appendChild(e)}}function J(){Y(),j(),G(),F(),O(),Z(),D.forEach(o=>{o.addEventListener("click",()=>{const t=o.getBoundingClientRect(),e=document.querySelector(".agent-container");if(e){const n=e.getBoundingClientRect();$=(t.left+t.width/2-n.left)/n.width*100,P=(t.top+t.height/2-n.top)/n.height*100,v=!0,o.classList.add("target-selected"),setTimeout(()=>{o.classList.remove("target-selected")},2e3),w&&(w.textContent="Dirigiéndose al objetivo seleccionado")}})})}setTimeout(J,500)});
